"use strict";(self.webpackChunkmmsp_station=self.webpackChunkmmsp_station||[]).push([[68687],{3109:(e,t,i)=>{i.d(t,{$x:()=>l,Wn:()=>h,XO:()=>o,iE:()=>u,y6:()=>a});var n=i(73582),r=i(2413),s=i(80963);class a{constructor(e,t,i,n,r){this.extent=e,this.timeExtent=t,this.size=i,this.pixelRatio=n,this.time=r}get flowExtentInfo(){return{modelSize:this.size,valid:(0,s.Vp)(this.extent.spatialReference)?.valid,extent:(0,r.VY)(this.extent)}}insideMapExtent(e,t){return l(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,i){return o(this.flowExtentInfo,e,t,i)}}function l(e,t,i){const{extent:n,valid:r}=e,[s,a,l,o]=n;return!(i<a||i>o)&&(null!=r&&s>l?t>=l||t<=s:t>=s&&t<=l)}function o(e,t,i,s){const{extent:a,modelSize:l,valid:o}=e,[u,c,d]=a,f=h(u,d,o);let m=t/l[0]*f+u;return null!=o&&s&&(m=new n.hr(o[0],o[1]).normalize(m)),[m,(l[1]-i)/l[1]*(0,r.uJ)(a)+c]}function u(e,t,i){return null!=i&&Math.abs(e-i.valid[0])<i.dx&&Math.abs(t-i.valid[1])<i.dx}function h(e,t,i){if(null!=i&&e>t){const[n,r]=i;return r-e+(t-n)}return t-e}},31516:(e,t,i)=>{i.d(t,{F:()=>s});i(18690),i(53084);var n=i(18288),r=i(59187);i(42052),i(72027);function s(e,t,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:a,useViewTime:l}=e;let o=e.timeExtent;s&&(o=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,i.getTimezoneOffset(),"minutes"):i})}(o));let u=l?t&&o?t.intersection(o):t||o:o;return!u||u.isEmpty||u.isAllTime?u:(a&&(u=u.offset(-a.value,a.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}(u)),u.equals(i)?i:u)}},31723:(e,t,i)=>{i.d(t,{DW:()=>c,Sw:()=>o,T5:()=>m,Xx:()=>u,Zt:()=>h,uu:()=>l});var n=i(2413),r=i(46533),s=i(76191),a=i(3109);function l(e){return e?4:3}function o(e){return e[0].vertices instanceof Float32Array}class u{constructor(e,t,i,n,r,s){this.data=e,this.mask=t,this.width=i,this.height=n,this.lij=r,this.extent=s}}function h(e){return(0,s.et)(e.lij[0],e.lij[1],e.lij[2])}function c(e,t){let[i,r,s,l]=[null,null,null,null];for(const n of e){const e=n.extent;i=f(e[0],i),r=f(e[1],r),s=d(e[2],s),l=d(e[3],l)}if(null==i||null==r||null==s||null==l)return null;if((0,a.iE)(i,s,t)){const t=[...e].toSorted((e,t)=>e.extent[0]-t.extent[0]);let n=t[0].extent[2],r=0,a=0,l=0;for(let e=1;e<t.length;e++){const[i,s,o]=t[e].extent;if(n<i&&(l++,r=n,a=i,l>1))break;n=Math.max(n,o)}1===l&&(i=a,s=r)}return(0,n.vt)([i,r,s,l])}function d(e,t){return null==t?e:Math.max(e,t)}function f(e,t){return null==t?e:Math.min(e,t)}function m(e,t,i){const[s,l]=i.modelSize;let o=null;const u=new Map;t.forEach(t=>{u.set(t.lij,(0,r.DE)(e,t))});const h=(e,t,i)=>(0,n.Rj)(e.extent,t,i);return(r,c)=>{const d=Math.round(r),f=Math.round(c);if(!e.wrapAround&&(d<0||d>=s||f<0||f>=l))return[0,0];const[m,g]=(0,a.XO)(i,r,c,!0);if(!(0,a.$x)(i,m,g))return[0,0];if(null==o||!h(o,m,g)){o=null;for(const[e,i]of t)if(h(i,m,g)){o=i;break}}if(null==o?.data)return[0,0];const p=u.get(o.lij);if(null==p)return[0,0];const{width:y,height:_,extent:v}=o;return p((m-v[0])/(0,n.VL)(v)*y,_-(g-v[1])/(0,n.uJ)(v)*_)}}},46533:(e,t,i)=>{i.d(t,{CW:()=>d,DE:()=>f,GA:()=>y,S1:()=>p,pH:()=>_});var n=i(81806),r=i(76460),s=i(15941),a=i(50346),l=i(47249),o=i(76797),u=i(80963);const h=()=>r.A.getLogger("esri.views.2d.engine.flow.dataUtils"),c=10;async function d(e,t,i,r){const s=performance.now(),o=f(t,i),u=performance.now(),d=p(t,o,i.width,i.height),m=performance.now(),g=function(e,t){const i=new l.A,n=e.reduce((e,t)=>e+t.vertices.length,0),r=new Float32Array(4*n),s=new Array(e.length);let a=0,o=0;for(const{vertices:l}of e){const e=a;for(const t of l)r[4*a]=t.x,r[4*a+1]=t.y,r[4*a+2]=t.t,r[4*a+3]=t.speed,a++;s[o++]={startVertex:e,numberOfVertices:l.length,totalTime:l[l.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:r,lineDescriptors:s}}(d,!0),y=performance.now(),_="Streamlines"===e?function(e,t){const i=9,{lineVertices:n,lineDescriptors:r}=e;let s=0,a=0;for(const f of r)s+=2*f.numberOfVertices,a+=6*(f.numberOfVertices-1);const l=new Float32Array(s*i),o=new Uint32Array(a);let u=0,h=0;function c(){o[h++]=u-2,o[h++]=u,o[h++]=u-1,o[h++]=u,o[h++]=u+1,o[h++]=u-1}function d(e,t,n,r,s,a,o,h){const c=u*i;let d=0;l[c+d++]=e,l[c+d++]=t,l[c+d++]=1,l[c+d++]=n,l[c+d++]=a,l[c+d++]=o,l[c+d++]=r/2,l[c+d++]=s/2,l[c+d++]=h,u++,l[c+d++]=e,l[c+d++]=t,l[c+d++]=-1,l[c+d++]=n,l[c+d++]=a,l[c+d++]=o,l[c+d++]=-r/2,l[c+d++]=-s/2,l[c+d++]=h,u++}for(const f of r){const{totalTime:e,timeSeed:i}=f;let r=null,s=null,a=null,l=null,o=null,u=null;for(let h=0;h<f.numberOfVertices;h++){const m=n[4*(f.startVertex+h)],g=n[4*(f.startVertex+h)+1],p=n[4*(f.startVertex+h)+2],y=n[4*(f.startVertex+h)+3];let _=null,v=null,w=null,x=null;if(h>0){_=m-r,v=g-s;const n=Math.sqrt(_*_+v*v);if(_/=n,v/=n,h>1){let e=_+o,i=v+u;const n=Math.sqrt(e*e+i*i);e/=n,i/=n;const r=Math.min(1/(e*_+i*v),t);e*=r,i*=r,w=-i,x=e}else w=-v,x=_;null!==w&&null!==x&&(d(r,s,a,w,x,e,i,y),c())}r=m,s=g,a=p,o=_,u=v,l=y}d(r,s,a,-u,o,e,i,l)}return{vertexData:l,indexData:o}}(g,c):function(e){const t=16,i=1,n=2,{lineVertices:r,lineDescriptors:s}=e;let a=0,l=0;for(const k of s){const e=k.numberOfVertices-1;a+=4*e*2,l+=6*e*2}const o=new Float32Array(a*t),u=new Uint32Array(l);let h,c,d,f,m,g,p,y,_,v,w,x,T,M,S=0,b=0;function R(){u[b++]=S-8,u[b++]=S-7,u[b++]=S-6,u[b++]=S-7,u[b++]=S-5,u[b++]=S-6,u[b++]=S-4,u[b++]=S-3,u[b++]=S-2,u[b++]=S-3,u[b++]=S-1,u[b++]=S-2}function A(e,r,s,a,l,u,h,c,d,f,m,g,p,y){const _=S*t;let v=0;for(const t of[i,n])for(const i of[1,2,3,4])o[_+v++]=e,o[_+v++]=r,o[_+v++]=s,o[_+v++]=a,o[_+v++]=h,o[_+v++]=c,o[_+v++]=d,o[_+v++]=f,o[_+v++]=t,o[_+v++]=i,o[_+v++]=p,o[_+v++]=y,o[_+v++]=l/2,o[_+v++]=u/2,o[_+v++]=m/2,o[_+v++]=g/2,S++}function V(e,t){let i=_+w,n=v+x;const r=Math.sqrt(i*i+n*n);i/=r,n/=r;const s=_*i+v*n;i/=s,n/=s;let a=w+T,l=x+M;const o=Math.sqrt(a*a+l*l);a/=o,l/=o;const u=w*a+x*l;a/=u,l/=u,A(h,c,d,f,-n,i,m,g,p,y,-l,a,e,t),R()}function L(e,t,i,n,r,s){if(_=w,v=x,w=T,x=M,null==_&&null==v&&(_=w,v=x),null!=m&&null!=g){T=e-m,M=t-g;const i=Math.sqrt(T*T+M*M);T/=i,M/=i}null!=_&&null!=v&&V(r,s),h=m,c=g,d=p,f=y,m=e,g=t,p=i,y=n}function C(e,t){_=w,v=x,w=T,x=M,null==_&&null==v&&(_=w,v=x),null!=_&&null!=v&&V(e,t)}for(const k of s){h=null,c=null,d=null,f=null,m=null,g=null,p=null,y=null,_=null,v=null,w=null,x=null,T=null,M=null;const{totalTime:e,timeSeed:t}=k;for(let i=0;i<k.numberOfVertices;i++)L(r[4*(k.startVertex+i)],r[4*(k.startVertex+i)+1],r[4*(k.startVertex+i)+2],r[4*(k.startVertex+i)+3],e,t);C(e,t)}return{vertexData:o,indexData:u}}(g),v=performance.now();return(0,n.A)("esri-2d-profiler")&&(h().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-s)),h().info("I.2","_getStreamlines (ms)",Math.round(m-u)),h().info("I.3","createAnimatedLinesData (ms)",Math.round(y-m)),h().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(v-y)),h().info("I.5","createFlowMesh (ms)",Math.round(v-s)),h().info("I.6","Mesh size (bytes)",_.vertexData.buffer.byteLength+_.indexData.buffer.byteLength)),await Promise.resolve(),(0,a.Te)(r),_}function f(e,t){const i=function(e,t,i,n){if(0===n)return e;const r=Math.round(3*n),s=new Array(2*r+1);let a=0;for(let u=-r;u<=r;u++){const e=Math.exp(-u*u/(n*n));s[u+r]=e,a+=e}for(let u=-r;u<=r;u++)s[u+r]/=a;const l=new Float32Array(e.length);for(let u=0;u<i;u++)for(let i=0;i<t;i++){let n=0,a=0;for(let l=-r;l<=r;l++){if(i+l<0||i+l>=t)continue;const o=s[l+r];n+=o*e[2*(u*t+(i+l))],a+=o*e[2*(u*t+(i+l))+1]}l[2*(u*t+i)]=n,l[2*(u*t+i)+1]=a}const o=new Float32Array(e.length);for(let u=0;u<t;u++)for(let e=0;e<i;e++){let n=0,a=0;for(let o=-r;o<=r;o++){if(e+o<0||e+o>=i)continue;const h=s[o+r];n+=h*l[2*((e+o)*t+u)],a+=h*l[2*((e+o)*t+u)+1]}o[2*(e*t+u)]=n,o[2*(e*t+u)+1]=a}return o}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,n)=>{const r=Math.floor(e),s=Math.floor(n);if(r<0||r>=t.width)return[0,0];if(s<0||s>=t.height)return[0,0];const a=e-r,l=n-s,o=r,u=s,h=r<t.width-1?r+1:r,c=s<t.height-1?s+1:s,d=i[2*(u*t.width+o)],f=i[2*(u*t.width+h)],m=i[2*(c*t.width+o)],g=i[2*(c*t.width+h)],p=i[2*(u*t.width+o)+1],y=i[2*(u*t.width+h)+1];return[(d*(1-l)+m*l)*(1-a)+(f*(1-l)+g*l)*a,(p*(1-l)+i[2*(c*t.width+o)+1]*l)*(1-a)+(y*(1-l)+i[2*(c*t.width+h)+1]*l)*a]}:(e,n)=>{const r=Math.round(e),s=Math.round(n);return r<0||r>=t.width||s<0||s>=t.height?[0,0]:[i[2*(s*t.width+r)],i[2*(s*t.width+r)+1]]}}function m(e,t,i,n,r,a,l,o){const u=[],{raster:h,width:c,height:d,resolutionFactor:f}=o;let m=n,g=r,p=0,[y,_]=i(m,g);y*=t.velocityScale,_*=t.velocityScale;const v=Math.sqrt(y*y+_*_);let w,x;u.push({x:m,y:g,t:p,speed:v});for(let T=0;T<t.verticesPerLine;T++){let[n,r]=i(m,g);n*=t.velocityScale,r*=t.velocityScale;const o=Math.sqrt(n*n+r*r);if(o<t.minSpeedThreshold)return u;const y=e*n/o,_=e*r/o;if(m+=y*t.segmentLength,g+=_*t.segmentLength,t.wrapAround&&(m=(0,s.OS)(m,a[0])),p+=e*t.segmentLength/o,Math.acos(y*w+_*x)>t.maxTurnAngle)return u;if(t.collisions){let e=Math.round(m*f);const i=Math.round(g*f);if(t.wrapAround&&(e=(0,s.OS)(e,c)),e<0||e>c-1||i<0||i>d-1)return u;const n=h[i*c+e];if(-1!==n&&n!==l)return u;h[i*c+e]=l}u.push({x:m,y:g,t:p,speed:o}),w=y,x=_}return u}function g(e,t,i,n,r,s,a,l){const o=Math.round((.2+.6*a.getFloat())*e.verticesPerLine),u=e.verticesPerLine-o,h=m(-1,{...e,verticesPerLine:u},t,i,n,r,s,l),c=m(1,{...e,verticesPerLine:o},t,i,n,r,s,l),d=h.reverse();return d.splice(-1,1),d.concat(c)}function p(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{positions:[]};if(e.density<=0)return[];const{positions:s}=r,a=[],o=new l.A,u=1/Math.max(e.lineCollisionWidth,1),h=Math.round(i*u),c=Math.round(n*u),d=new Int32Array(h*c);for(let l=0;l<d.length;l++)d[l]=-1;const f={raster:d,width:h,height:c,resolutionFactor:u},p={},y=e.lineSpacing/Math.sqrt(e.density),_=Math.floor(n/y),v=Math.floor(i/y);for(let l=0;l<_;l++){const e=l*y;for(let t=0;t<v;t++){const i=t*y;p[`${t}-${l}`]={x:i,y:e,positions:[]}}}for(const{x:l,y:m}of s){const e=p[`${Math.floor(l/y)}-${Math.floor(m/y)}`];e&&e.positions.push([l,m])}const w=[];for(const l in p){const e=p[l];if(0===e.positions.length)w.push({x:e.x+y/2,y:e.y+y/2,sort:.66+.33*o.getFloat(),stage:0});else{const[t]=e.positions.splice(0,1);w.push({x:t[0],y:t[1],sort:.33*o.getFloat(),stage:1});for(const[i,n]of e.positions)w.push({x:i,y:n,sort:.33+.33*o.getFloat(),stage:2})}}w.sort((e,t)=>e.sort-t.sort);for(const{x:l,y:x,stage:T}of w){const r=e.onlyForwardTracing?m(1,e,t,l,x,[i,n],a.length,f):g(e,t,l,x,[i,n],a.length,o,f);r.length<2||a.push({stage:T,vertices:r})}return a}function y(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=t.pixels,o=i*n,u=new Float32Array(2*o),h=t.width,c=(e,t)=>e+r+(t+a)*h,d=(e,t)=>e+t*i;let f;if(null!=t.mask)if(i!==t.width||n!==t.height||0!==r||0!==a){f=new Uint8Array(2*o);const e=t.mask;for(let t=0;t<n;++t)for(let n=0;n<i;++n){const i=c(n,t),r=d(n,t);f[2*r]=e[2*i],f[2*r+1]=e[2*i+1]}}else f=t.mask;else f=new Uint8Array(2*o),f.fill(255);if("vector-uv"===e)for(let s=0;s<n;++s)for(let e=0;e<i;++e){const t=c(e,s),i=d(e,s);u[2*i]=l[0][t],u[2*i+1]=-l[1][t]}else if("vector-magdir"===e){const{cos:e,sin:t}=Math;for(let r=0;r<n;++r)for(let n=0;n<i;++n){const i=c(n,r),a=d(n,r),o=l[0][i],h=(0,s.kU)(l[1][i]),f=e(h-Math.PI/2),m=t(h-Math.PI/2);u[2*a]=f*o,u[2*a+1]=m*o}}return{data:u,mask:f,width:i,height:n}}async function _(e,t,i,r,s,a){const l=performance.now(),c=(0,u.Vp)(t.spatialReference);if(!c){const o=await v(e,t,i,r,s,a);return(0,n.A)("esri-2d-profiler")&&h().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-l)),(0,n.A)("esri-2d-profiler")&&h().info("I.9","Number of parts",1),o}const[d,f]=c.valid,m=f-d,g=Math.ceil(t.width/m),p=t.width/g,y=Math.round(i/g);let _=t.xmin;const w=[],x=performance.now();for(let n=0;n<g;n++){const i=new o.A({xmin:_,xmax:_+p,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});w.push(v(e,i,y,r,s,a)),_+=p}const T=await Promise.all(w);if((0,n.A)("esri-2d-profiler")&&h().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),(0,n.A)("esri-2d-profiler")&&h().info("I.9","Number of parts",T.length),1===T.length)return(0,n.A)("esri-2d-profiler")&&h().info("I.10","loadImagery, general exit without stitching back (ms)",Math.round(performance.now()-l)),T[0];const M={data:new Float32Array(i*r*2),mask:new Uint8Array(i*r),width:i,height:r};let S=0;for(const n of T){for(let e=0;e<n.height;e++)for(let t=0;t<n.width;t++)S+t>=i||(M.data[2*(e*i+S+t)]=n.data[2*(e*n.width+t)],M.data[2*(e*i+S+t)+1]=n.data[2*(e*n.width+t)+1],M.mask[e*i+S+t]=n.mask[e*n.width+t]);S+=n.width}return(0,n.A)("esri-2d-profiler")&&h().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-l)),M}async function v(e,t,i,n,r,s){const a={requestProjectedLocalDirections:!0,signal:s};if(null!=r&&(a.timeExtent=r),"imagery"===e.type){await e.load({signal:s});const r=await e.internalFetchImage(t,i,n,a);return null==r?.pixelData?.pixelBlock?{data:new Float32Array(i*n*2),mask:new Uint8Array(i*n),width:i,height:n}:y(e.rasterInfo.dataType,r.pixelData.pixelBlock)}await e.load({signal:s});const l=await e.fetchPixels(t,i,n,a);return null==l?.pixelBlock?{data:new Float32Array(i*n*2),mask:new Uint8Array(i*n),width:i,height:n}:y(e.serviceRasterInfo.dataType,l.pixelBlock)}},51939:(e,t,i)=>{i.d(t,{AL:()=>_,DV:()=>g,ER:()=>r,F_:()=>l,Nd:()=>f,Oo:()=>s,dy:()=>d,eS:()=>T,h4:()=>M,jC:()=>y,nq:()=>m,rZ:()=>c,y6:()=>p});var n=i(44135);const r="Raster.",s="Raster.Dim.",a=".Max",l={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},o=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function u(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function h(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"double"})}function c(e){return u(l.servicePixelValue,e??"Service Pixel Value")}function d(e){return u(l.rawServicePixelValue,e??"Raw Service Pixel Value")}function f(){return u(l.itemPixelValue,"Item Pixel Value")}function m(e){return u(`${l.servicePixelValue}.${e}`,e)}function g(e){return h(`${l.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function p(){return h(`${l.direction}`,"Direction (\xb0)")}function y(e){return e.fields.filter(e=>"oid"!==e.type&&"value"!==e.name.toLowerCase()).map(e=>{const t=e.clone();return t.name=`${r}${e.name}`,t})}function _(e){const t=new Set,i=new Set,r=new Map;return e.variables.forEach(e=>{let{dimensions:n}=e;n.forEach(e=>{if(e.recurring)r.set(e.name,e.unit);else{const n="ISO8601"===e.unit?.trim()||"stdtime"===e.name?.trim()?.toLowerCase()?t:i;n.add(e.name),e.hasRanges&&n.add(`${e.name}${a}`)}})}),[u(l.variable,"Variable"),...[...t].map(e=>function(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"date"})}(`${s}${e}`,w(e))),...[...i].map(e=>h(`${s}${e}`,w(e))),...[...r].map(e=>{let[t,i]=e;return h(`${s}${t}`,v(t,i))})]}function v(e,t){return t=t?.toLowerCase(),t&&o.has(t)?o.get(t):w(e)}function w(e){const t=e.endsWith(a),i=t?e.slice(0,-4):e,n="StdTime"===i?"Standard Time":"StdZ"===i?"Standard Z":i;return t?`${n} Max`:n}function x(e,t){return t?new Date(e):e}function T(e,t,i){i?.length&&(t[l.variable]=i[0].variableName,i.forEach(i=>{let{dimensionName:n,values:r}=i;if(n&&r?.length){const i=`${s}${n}`,l=e.find(e=>{let{name:t}=e;return t===i});if(!l)return;const o="date"===l.type,u=r[0];if(Array.isArray(u)){if(t[`${s}${n}`]=x(u[0],o),null!=u[1]){const i=`${s}${n}${a}`;if(e.some(e=>{let{name:t}=e;return t===i})){const e=x(u[1],o);t[i]=e}}}else t[`${s}${n}`]=x(u,o)}}))}function M(e,t){if(t.pixelType.startsWith("f")&&e.forEach(e=>{let{format:t,fieldName:i}=e;t&&i&&/^raster\.(item|service)pixelvalue/i.test(i)&&(t.places=2)}),t.multidimensionalInfo){const i=t.multidimensionalInfo.variables.flatMap(e=>{let{dimensions:t}=e;return t});e.forEach(e=>{let{format:t,fieldName:n}=e;if(t&&n?.startsWith(s)){const e=n.slice(s.length),r=`${e}${a}`,l=i.find(t=>{let{name:i}=t;return i===e||i===r});l?.values?.every(e=>Number.isInteger(e))&&(t.places=0)}})}}},64147:(e,t,i)=>{i.d(t,{$7:()=>u,Ci:()=>m,Cq:()=>g,FO:()=>h,NK:()=>d,S$:()=>n,iM:()=>f,jt:()=>s,nD:()=>o,q6:()=>a,q7:()=>l,ti:()=>c,um:()=>r});const n=.1,r=1,s=1,a=1e3,l=!1,o=3,u=1,h=1.5,c=501,d=256,f=3,m=2,g=2},66917:(e,t,i)=>{i.d(t,{Dt:()=>_,EO:()=>f,Lu:()=>a,Sl:()=>p,UL:()=>c,YC:()=>u,hq:()=>s,l0:()=>o,oU:()=>h,r$:()=>m,vG:()=>g});var n=i(76931),r=i(31723);function s(e){const t=a(u(e)),i=t,r=Math.max(t/2,5),s=Math.round((0,n.Lz)(e.maxPathLength)/r)+1,{density:l}=e;return{smoothing:(0,n.Lz)(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:s,minSpeedThreshold:.001,segmentLength:r,maxTurnAngle:1,collisions:!0,lineCollisionWidth:i,lineSpacing:10,density:l,onlyForwardTracing:!0,wrapAround:!1}}function a(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function l(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function o(e){return{kind:"constant",value:[.1,.1,.1,1]}}function u(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,n.Lz)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],r=[];let s;if(t.stops){for(const e of t.stops)i.push(e.value),r.push((0,n.Lz)(e.size));s=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),r.push((0,n.Lz)(t.minSize),(0,n.Lz)(t.maxSize)),s=2;return{kind:"ramp",stops:i,values:r,count:s}}function h(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:l(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],n=[];for(const r of t.stops)i.push(r.value),Array.prototype.push.apply(n,l(r.color));return{kind:"ramp",stops:i,values:n,count:t.stops.length}}function c(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],n=[];for(const r of t.stops)i.push(r.value),n.push(r.opacity);return{kind:"ramp",stops:i,values:n,count:t.stops.length}}function d(e,t,i,n){switch(t){case"int":e.setUniform1iv(i,n);break;case"float":e.setUniform1fv(i,n);break;case"vec2":e.setUniform2fv(i,n);break;case"vec3":e.setUniform3fv(i,n);break;case"vec4":e.setUniform4fv(i,n)}}function f(e,t,i,n){"constant"===n.kind?d(e,i,`u_${t}`,n.value):(d(e,"float",`u_${t}_stops`,n.stops),d(e,i,`u_${t}_values`,n.values),e.setUniform1i(`u_${t}_count`,n.count))}function m(e,t){let i=!0;return i=i&&e.collisions===t.collisions,i=i&&e.density===t.density,i=i&&e.interpolate===t.interpolate,i=i&&e.lineCollisionWidth===t.lineCollisionWidth,i=i&&e.lineSpacing===t.lineSpacing,i=i&&e.maxTurnAngle===t.maxTurnAngle,i=i&&e.minSpeedThreshold===t.minSpeedThreshold,i=i&&e.segmentLength===t.segmentLength,i=i&&e.smoothing===t.smoothing,i=i&&e.velocityScale===t.velocityScale,i=i&&e.verticesPerLine===t.verticesPerLine,i}function g(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}function p(e,t){if(!m(e.simulationSettings,t.simulationSettings))return!1;if(!g(e.timeExtent,t.timeExtent))return!1;let i=!0;return i=i&&e.loadImagery===t.loadImagery,i=i&&e.createFlowMesh===t.createFlowMesh,i=i&&e.color.kind===t.color.kind,i=i&&e.opacity.kind===t.opacity.kind,i=i&&e.size.kind===t.size.kind,i}function y(e,t,i,n){return e/=i.size[0],t=1-(t/=i.size[1]),e*=i.extent.xmax-i.extent.xmin,t*=i.extent.ymax-i.extent.ymin,e+=i.extent.xmin,t+=i.extent.ymin,e-=n.extent.xmin,t-=n.extent.ymin,e/=n.extent.xmax-n.extent.xmin,t=1-(t/=n.extent.ymax-n.extent.ymin),{x:e*=n.size[0],y:t*=n.size[1]}}function _(e,t,i,n){const s=[],a=i.time-t.time;if(0===e.length)return[];const l=(0,r.Sw)(e),o=l?(0,r.uu)(e[0].hasMagnitude):1,u=l?(e,t)=>{let{vertices:i}=e;const n=i,r=t*o;return{x:n[r],y:n[r+1],t:n[r+2],speed:0}}:(e,t)=>{let{vertices:i}=e;return i[t]};for(const r of e){const{stage:e,vertices:l}=r;if(2===e)continue;const h=l.length/o,c=u(r,0),d=c.t,f=(a*n-d)%(u(r,h-1).t-d)+d;let m,g=c.x,p=c.y,_=c.t;for(m=1;m<h&&_<f;m++){const e=u(r,m),t=Math.min(e.t,f)-_,i=e.t-_;g+=(e.x-g)*(t/i),p+=(e.y-p)*(t/i),_+=t}s.push(y(g,p,t,i))}return s}},76191:(e,t,i)=>{i.d(t,{Tb:()=>s,et:()=>u,mS:()=>l,nx:()=>a});var n=i(34111),r=i(2413);const s="virtual-snapshot-tile",a="virtual-display-filter-highlight-tile";class l{constructor(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u(e,t,i);this._tilingScheme=n,this.id=s,this.lij=[0,0,0],this.extent=null,this.measures=new o,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=t,this.lij[2]=i,n&&(this.extent=(0,r.vt)(),n?.getExtent(e,t,i,this.extent))}get planetRadius(){return(0,n.tO)(this.spatialReference).radius}get spatialReference(){return this._tilingScheme?.spatialReference}get resolution(){return this._tilingScheme?.resolutionAtLevel(this.measures.lodLevel)??0}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,t=2*this.lij[1],i=2*this.lij[2];return[new l(e,t,i,this._tilingScheme),new l(e,t+1,i,this._tilingScheme),new l(e,t,i+1,this._tilingScheme),new l(e,t+1,i+1,this._tilingScheme)]}}class o{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}}function u(e,t,i){return`${e}/${t}/${i}`}},89214:(e,t,i)=>{i.d(t,{A:()=>Y});var n=i(6326),r=i(18690),s=(i(81806),i(30726)),a=i(50346),l=i(68134),o=i(52394),u=i(91417),h=i(31633),c=i(46053),d=(i(76460),i(87990)),f=i(34111),m=i(56611),g=i(2413),p=i(80963),y=i(731),_=i(66917),v=i(69576),w=i(1873),x=i(64147),T=i(3109),M=i(12016);class S extends M.B{constructor(e){super("FlowWorker","generateStreamlines",{generateStreamlines:e=>[e.flowData.data.buffer,e.flowData.mask.buffer],generateTiledStreamlines:e=>{const t=[];return e.flowDataTiles.forEach(e=>{"loaded"===e.type&&t.push(e.data.data.buffer,e.data.mask.buffer)}),t}},e,{strategy:"dedicated"})}generateStreamlines(e,t){return this.invokeMethod("generateStreamlines",e,t)}generateTiledStreamlines(e,t){return this.invokeMethod("generateTiledStreamlines",e,t)}}var b=i(69539),R=i(9392),A=i(75002),V=i(94587),L=i(12482),C=i(63048),k=i(70667),P=i(31723),D=i(1599);function I(e,t,i,n,r,s){let{vertices:a,stage:l,hasMagnitude:o}=i;const{spatialReference:u}=t.extent,h=[],c=(0,P.uu)(o),d=t.flowExtentInfo.modelSize[0];let f=0;for(let M=0;M<a.length;M+=c){if(s&&M>0){const e=a[M]-a[M-c];e>d/2?f-=d:-e>d/2&&(f+=d)}const[i,r]=t.modelToMapSpace(a[M]+f,a[M+1],!1),l=s?[i,r,D.bi]:F(i,r,u,e,n);h.push(l)}const m=Math.floor(a.length/c),g=(0,V.fY)(m);for(let M=0;M<m;M++)g[M]=a[M*c+2];const{hasVVColor:p,hasVVOpacity:y,hasVVSize:_}=r.parameters;let v,w,x;if(o&&(p||y||_)){const e=(0,A.oe)(m);for(let t=0;t<m;t++)e[t]=a[t*c+3];p&&(v=[e]),y&&(w=[e]),_&&(x=[e])}const T=(0,k.yU)([h],void 0,[{timeStamps:g,streamlineType:l}],v,w,x);return(0,k.te)(r,T[0])}function E(e,t,i){if(null==e)return{};let n=null;if(e.visualVariables){const t=[],i=e.visualVariables,r=new C.wI({supports:{size:!0,color:!0,rotation:!1,opacity:!0}});n=(0,C.T3)(i,r,t)}const r=n?.color?[1,1,1,1]:b.A.toUnitRGBA(e.color);return r[3]*=t,{color:r,width:e.trailWidth,cap:0,animationSpeed:e.flowSpeed,trailLength:e.trailLength,animation:3,emissiveStrength:i,vvColor:n?.color,vvOpacity:n?.opacity,vvSize:n?.size}}function F(e,t,i,n,r){const{absoluteZ:s}=(0,L.Q5)(e,t,0,i,n,r),a=(0,R.fA)(e,t,s);return n.renderCoordsHelper.toRenderCoords(a,i,a),a}var $=i(48989),q=i(97255);class O{constructor(e,t,i,n,r){this._query=e,this.streamlines=t,this._material=i,this.geometries=n,this._bytesPerFeature=r,this._startTime=0,this._endTime=1/0,this.usedMemory=null,this.startTime=this._query.time,this.computeMemory()}computeMemory(){const e=(0,q.Qh)(this.streamlines),t=(0,q.Qh)(this.geometries.map(e=>e.attributes)),i=this.streamlines.length*this._bytesPerFeature;this.usedMemory=e+t+i}get startTime(){return this._startTime}set startTime(e){this._query.time!==e&&(this._query=new T.y6(this._query.extent,this._query.timeExtent,this._query.size,this._query.pixelRatio,(0,u.Kp)(e))),this._startTime=e,this.setMaterialParameters({startTime:e})}get endTime(){return this._endTime}set endTime(e){this._endTime=e,this.setMaterialParameters({endTime:e})}get query(){return this._query}hasFadedOut(e){return this.endTime+this._material.parameters.fadeOutTime<e}setMaterialParameters(e){this._material.setParameters(e)}get test(){return null}}var Z=i(442),z=i(59752);class U extends O{constructor(e,t,i,n,r){super(e,t,i,n,$.Fq.LINE_ROUND.draped.bytesPerFeature),this._layerView=r,this._drapeRenderer=null,this.drapeSourceType=2,this.updatePolicy=0,this.renderGroup=0,this._frameTask=null,this._renderGeometries=[]}get _view(){return this._layerView.view}get layer(){return this._layerView.layer}get fullOpacity(){return this._layerView.fullOpacity}get attached(){return null!=this._drapeRenderer}get destroyed(){return this.attached}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(z.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToOverlay(e,t)))}async*_addGeometryToOverlay(e,t){this._drapeRenderer=this._view.overlayManager.registerGeometryDrapeSource(this);for(let i=0;i<e.length;i+=x.ti){const n=e.slice(i,i+x.ti).map(e=>new Z.$(e));this._drapeRenderer.addGeometries(n,0),this._renderGeometries.push(...n),this._drapeRenderer.commitChanges(),t.madeProgress(),t.done&&(t=yield)}}detach(){this._frameTask=(0,s.xt)(this._frameTask),this._drapeRenderer&&(this._drapeRenderer.removeGeometries(this._renderGeometries,2),this._drapeRenderer.commitChanges(),this._renderGeometries.length=0),this.attached&&this._view.overlayManager.unregisterDrapeSource(this),this._drapeRenderer=(0,s.pR)(this._drapeRenderer)}}var W=i(37046),j=i(8918);class G extends O{constructor(e,t,i,n,r){super(e,t,i,n,$.Fq.LINE_ROUND.bytesPerFeature),this._view=r,this._objects3D=[],this._engineLayer=null,this._frameTask=null}get attached(){return null!=this._engineLayer}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(z.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToLayer(e,t)))}detach(){this.attached&&(this._engineLayer?.removeMany(this._objects3D),this._objects3D.forEach(e=>e.dispose()),this._engineLayer?.commit(),this._objects3D=[],this._engineLayer=null,this._frameTask=(0,s.xt)(this._frameTask))}async*_addGeometryToLayer(e,t){const{stage:i}=this._view,n=new j.x(i,{pickable:!1,updatePolicy:1});for(let r=0;r<e.length;r+=x.ti){const i=new W.B({geometries:e.slice(r,r+x.ti),castShadow:!1});n.add(i),this._objects3D.push(i),n.commit(),t.madeProgress(),t.done&&(t=yield)}this._engineLayer=n}}var B=i(9902),N=i(12028),H=i(52479),K=i(90992);let Y=class extends v.A{constructor(e){super(e),this.type="flow",this.renderedTiles=null,this.requireLoad=!1,this.workerHandle=null,this.frameTask=null,this._averageLoadingTime=(0,u.Kp)(0),this._abortController=null,this._loadingState="ready-to-load",this._tilesUpdateIsWaiting=!1,this._debugAllowAutoLoading=!0,this.emissiveStrength=0,this._overrideMaterialParameters=null,this._overrideSimulationSettings=null,this._overrideTransitionEnabled=null,this._updateTask=null,this._debouncedTileUpdate=(0,a.sg)(async()=>{const{allTiles:e}=this.surface,t=this._getTileFilterFunction(),i=new Set;await this.frameTask.scheduleGenerator(function*(n){for(let r=0;r<e.length;++r){const s=e.at(r);t(s)&&i.add(s),n.madeProgress(),n.done&&(n=yield)}}),this.renderedTiles=i})}initialize(){const{surface:e,view:t}=this,{resourceController:i}=t;this.workerHandle=new S((0,w.m)(i)),this.frameTask=i.scheduler.registerTask(z.W6.FLOW_GENERATOR),this._updateTask=(0,o.mg)({update:e=>this._update(e)}),this.addHandles([(0,l.wB)(()=>this._simulationSettings,()=>this.triggerLoad(),{sync:!0,equals:(e,t)=>null==e&&null==t||null!=e&&null!=t&&(0,_.r$)(e,t)}),(0,l.wB)(()=>{const{elevationInfo:e}=this;return[this._clippingArea,this._visible,this._draped,this.view.state.contentPixelRatio,this.view.viewingMode,e?.mode,e?.offset,e?.unit,this._effectiveDensity]},()=>this.triggerLoad(),l.OH),(0,l.wB)(()=>this._materialParameters,e=>{this._resources?.setMaterialParameters(e),this._lastResources?.setMaterialParameters(e)}),e.on("tiles-changed",()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()}),t.enableFeatureTiles(),(0,l.wB)(()=>[this._dataBounds,this._featureTilesBounds,this.loadAllTiles],()=>this._triggerTilesUpdate()),(0,l.wB)(()=>this._flowRenderer,(e,t)=>{const i=t?.visualVariables??[],n=e?.visualVariables??[];n.length===i.length&&n.every((e,t)=>e.type===i[t].type)||this.clear()}),(0,l.z7)(()=>!t.featureTiles?.updating,()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()})]),this._triggerTilesUpdate()}destroy(){this._updateTask=(0,s.xt)(this._updateTask),this.abort(),this.clear()}abort(){this._abortController=(0,s.DC)(this._abortController),this.requireLoad=!1}get _clippingArea(){const e=(0,m.projectOrLoad)(this.view.clippingArea,this.surface.spatialReference).geometry;return null==e?null:(0,g.VY)(e)}get _dataBounds(){const e=(0,m.projectOrLoad)(this.layer.fullExtent,this.surface.spatialReference).geometry;return null==e?null:(0,g.VY)(e)}get _draped(){return"on-the-ground"===this.elevationInfo.mode}get _ellipsoidRadius(){return(0,f.tO)(this.view.spatialReference).radius}get extent(){const{spatialReference:e}=this.surface;let t=this.renderedTiles;if(null==e||null==t)return null;const i=this.view.terrainLevel;if(null!=i){const e=new Set;t.forEach(t=>{Math.abs(i-t.level)<x.iM&&e.add(t)}),t=e}const n=(0,P.DW)(t,this.spatialReferenceInfo);return null==n?null:((0,g.E$)(n,this._clippingArea,n),(0,g.w1)(n,e))}get loadAllTiles(){const{position:e}=this.view.camera,t=e.z;return null!=t&&t*(0,h.G9)(e.spatialReference)/this._ellipsoidRadius>=x.FO}get isDataGlobal(){const{extent:e,spatialReferenceInfo:t}=this;return null!=e&&(0,T.iE)(e.xmin,e.xmax,t)}get loadByTileTreesAllowed(){return!this.loadAllTiles||!this.loadRequirementsMet}get _featureTilesBounds(){const e=this.view.featureTiles?.filterExtent,t=(0,m.projectOrLoad)(e,this.surface.spatialReference).geometry;return null==t?null:(0,g.VY)(t)}get _flowRenderer(){const e=this.layer.renderer;return"flow"!==e?.type?null:e}get _materialParameters(){return{...E(this._flowRenderer,this.layerView.fullOpacity,this.emissiveStrength),fadeInTime:x.jt,fadeOutTime:x.um,...this._overrideMaterialParameters,hasSlicePlane:this.layerView.slicePlaneEnabled,screenSizePerspective:!this._draped&&(0,N.tl)(this.layer.screenSizePerspectiveEnabled)?this.view.screenSizePerspective.parameters:null}}get _opacity(){return this.layerView.fullOpacity}get _seamlessTransitionWaitingTime(){const{_averageLoadingTime:e}=this;return(0,u.Kp)(0===e?x.$7:this._averageLoadingTime*x.nD)}get _seamlessTransitionEnabled(){return null!=this._overrideTransitionEnabled?this._overrideTransitionEnabled:x.q7}get _tracingResolution(){const{extent:e}=this;if(!e)return[0,0];const t=(0,T.Wn)(e.xmin,e.xmax,this.spatialReferenceInfo?.valid)/(e.ymax-e.ymin),[i,n]=this.view.size;let r,s;i<n?(r=i,s=i/t):(r=n*t,s=n);const a=x.NK,l=this.view.qualitySettings.flow3D.maxTracingResolution,o=Math.max(1,a/Math.min(r,s)),u=o*Math.min(1,l/Math.max(r*o,s*o));return[Math.round(r*u),Math.round(s*u)]}get _visible(){const e=this._flowRenderer?.color;return this.visibleAtCurrentScale&&this.layer.effectiveVisible&&this._opacity>0&&(null==e||e.a>0)}get _estimatedStreamlines(){const{extent:e,_simulationSettings:t,renderedTiles:i}=this;if(null==t||null==i)return 0;const n=this._tracingResolution[0]*this._tracingResolution[1]/t.lineSpacing**2*t.density,r=null==e?null:(0,g.VY)(e);if(null==r)return 0;let s=0;for(const o of i)(0,g.gR)(r,o.extent)&&(s+=(0,g.Wc)(o.extent));const a=(0,g.Wc)(r),l=0===a?0:s/a;return 2*Math.round(n*l)}get _effectiveDensity(){const{_estimatedStreamlines:e,_simulationSettings:t}=this,{qualitySettings:i,quality:n}=this.view;if(null==t)return 0;const r=i.flow3D.maxTotalNumberOfStreamlines,s=e>=r?r/e:1,a=t.density*s*n;return t.lineSpacing/Math.sqrt(a)<t.lineCollisionWidth?(t.lineSpacing/t.lineCollisionWidth)**2:a}get elevationInfo(){return this.layer.elevationInfo??Q}startPositions(e){if(!this._seamlessTransitionEnabled)return[];const{_flowRenderer:t,_resources:i}=this;return null==t||null==i?[]:(0,_.Dt)(i.streamlines,i.query,e,t.flowSpeed)}get needsMagnitude(){return this._flowRenderer?.hasVisualVariables()??!1}get spatialReferenceInfo(){return(0,p.Vp)(this.surface.spatialReference)}get layer(){return this.layerView.layer}get loadingState(){return this._loadingState}get loadRequirementsMet(){return null!=this.renderedTiles&&this.renderedTiles.size>0}getUpdating(){return this.updatingHandles.updating||this.requireLoad||"before-transition"===this._loadingState}get updating(){return this.getUpdating()}get visibleAtCurrentScale(){return!(0,K.j)()||(0,K.E5)(this.layer.effectiveScaleRange,this.view.scale)}get _simulationSettings(){const{_flowRenderer:e,_overrideSimulationSettings:t}=this;if(null==e)return null;let i=(0,_.hq)(e);return i.segmentLength=i.lineCollisionWidth/2,i.onlyForwardTracing=!1,i.density*=x.Ci,this.loadAllTiles&&this.isDataGlobal&&(i.density*=x.Cq),null!=t&&(i={...i,...t}),i}getSimulationSettings(e){const{_simulationSettings:t,spatialReferenceInfo:i}=this;if(null==t)return null;const n="global"===this.view.viewingMode&&null!=i&&(0,T.iE)(e.extent.xmin,e.extent.xmax,i);return{...t,wrapAround:n,density:this._effectiveDensity}}get surface(){return this.view.basemapTerrain}doRefresh(){this.triggerLoad()}clear(){this._resources?.detach(),this._resources=null,this._lastResources?.detach(),this._lastResources=null,this._loadingState="ready-to-load"}_update(e){const t=(0,u.y)(e.time);this._lastResources?.hasFadedOut(t)&&this._lastResources.detach();const i=this._nextStateForTransition(t);if(!this.requireLoad||this.updatingHandles.updating||"ready-to-load"!==i||!this.loadRequirementsMet)return void(this._loadingState=i);this._loadingState="loading";this.updatingHandles.addPromise((0,a.QZ)((async()=>{const e=performance.now(),i=this._seamlessTransitionEnabled&&null!=this._resources?(0,u.Kp)(t+this._seamlessTransitionWaitingTime):t;await this._load(i);const n=(0,u.Kp)((performance.now()-e)/1e3);this._updateAverageLoadingTime(n)})())),this.requireLoad=!1}_updateAverageLoadingTime(e){const t=x.S$;this._averageLoadingTime=(0,u.Kp)(t*e+(1-t)*this._averageLoadingTime)}triggerLoad(){this._debugAllowAutoLoading&&(this.requireLoad=!0)}async _load(e){const{extent:t,view:i}=this;if(!this._visible)return this.clear(),void(this._loadingState="ready-to-load");if(null==t)return void(this._loadingState="ready-to-load");const n=new T.y6(t,this.layerView.timeExtent,this._tracingResolution,i.state.contentPixelRatio,e);null==this._abortController&&(this._abortController=new AbortController);const r=this._abortController,s=await this._loadStreamlines(n,r.signal);if((0,a.Te)(r.signal),this._visible&&null!=s){this._lastResources?.detach(),this._lastResources=this._resources,this._resources=s;const t=performance.now()/1e3,i=t>e?t:e;null!=this._lastResources&&(this._lastResources.endTime=i),this._resources.startTime=i,await s.attach(),this._loadingState=this._seamlessTransitionEnabled?"before-transition":"transitioning"}else this._loadingState="ready-to-load"}async _loadStreamlines(e,t){const i=await this.fetchDataAndGenerateStreamlines(e,t);if(null==i)return null;const{geometries:n,material:r}=await this._createGeometry(e,i);return this._draped?new U(e,i,r,n,this.layerView):new G(e,i,r,n,this.view)}async fetchDataAndGenerateStreamlines(e,t){return null}async _createGeometry(e,t){const i=new H.W(this._materialParameters,this.view.state.isGlobal),n=new Array,{elevationInfo:r,_draped:s,view:a}=this;return await this.frameTask.scheduleGenerator(function*(l){for(let o=0;o<t.length;++o)n.push(I(a,e,t[o],r,i,s)),l.madeProgress(),l.done&&(l=yield)}),{geometries:n,material:i}}_triggerTilesUpdate(){if(this._tilesUpdateIsWaiting)return;this._tilesUpdateIsWaiting=!0;this.updatingHandles.addPromise((0,a.QZ)((async()=>{await(0,l.C_)(()=>this.view.stationary),this._tilesUpdateIsWaiting=!1,await this._debouncedTileUpdate()})()))}_getTileFilterFunction(){const{_dataBounds:e,view:t,_featureTilesBounds:i}=this;if(this.loadAllTiles)return t=>t.leaf&&X(e,t.extent);const n=t=>t.rendered&&t.visible&&X(e,t.extent),{featureTiles:s}=t;if(!s)return n;const a=s.tiles.filter(e=>e.measures.visible);return e=>n(e)&&X(i,e.extent)&&a.some(t=>{let{lij:i}=t;return(0,r.aI)(i,e.lij)||(0,B.ZH)(i,e.lij)})}_nextStateForTransition(e){const{_resources:t}=this;if(null==this._flowRenderer||null==t||"ready-to-load"===this._loadingState||"loading"===this._loadingState)return this._loadingState;const i=t.startTime;return e<i?"before-transition":e<i+x.um?"transitioning":"ready-to-load"}get usedMemory(){return(this._lastResources?.usedMemory??0)+(this._resources?.usedMemory??0)}get test(){}};(0,n.Cg)([(0,c.MZ)()],Y.prototype,"type",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"renderedTiles",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_resources",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_lastResources",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"requireLoad",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_averageLoadingTime",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_loadingState",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"emissiveStrength",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_clippingArea",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_dataBounds",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_draped",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_ellipsoidRadius",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"extent",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"loadAllTiles",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"isDataGlobal",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_featureTilesBounds",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_flowRenderer",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_materialParameters",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_opacity",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_seamlessTransitionWaitingTime",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_seamlessTransitionEnabled",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_tracingResolution",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_visible",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_estimatedStreamlines",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_effectiveDensity",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"elevationInfo",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"needsMagnitude",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"spatialReferenceInfo",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"layer",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"loadingState",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"updating",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"visibleAtCurrentScale",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_overrideMaterialParameters",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_overrideSimulationSettings",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_overrideTransitionEnabled",void 0),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"_simulationSettings",null),(0,n.Cg)([(0,c.MZ)()],Y.prototype,"surface",null),Y=(0,n.Cg)([(0,d.$)("esri.views.3d.layers.FlowSubView3D")],Y);const Q=new y.A({mode:"on-the-ground"});function X(e,t){return null==e||null==t||(0,g.HY)(e,t)}}}]);
//# sourceMappingURL=68687.555fd5ee.chunk.js.map